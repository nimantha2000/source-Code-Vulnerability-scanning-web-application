from flask import Flask, render_template, request
import subprocess
import tempfile
import os

app = Flask(__name__)

def scan_code(code):
    try:
        # Save the code to a temporary file
        with tempfile.NamedTemporaryFile(mode='w', delete=False, suffix='.py') as file:
            temp_code_path = file.name
            file.write(code)

        # Run bandit to scan the code
        bandit_result = subprocess.run(['bandit', '-r', temp_code_path], capture_output=True, text=True)

        # Run sqlmap to scan the code
        sqlmap_result = subprocess.run(['sqlmap', '--batch', '-r', temp_code_path], capture_output=True, text=True)

        # Remove the temporary file
        os.remove(temp_code_path)

        return {
            'bandit_result': bandit_result.stdout,
            'sqlmap_result': sqlmap_result.stdout
        }
    except Exception as e:
        return {'error': str(e)}

@app.route('/', methods=['GET', 'POST'])
def index():
    if request.method == 'POST':
        user_code = request.form['code']
        scan_result = scan_code(user_code)
        return render_template('index.html', code=user_code, bandit_result=scan_result.get('bandit_result', ''), sqlmap_result=scan_result.get('sqlmap_result', ''))

    return render_template('index.html', code='', bandit_result='', sqlmap_result='')

if __name__ == '__main__':
    app.run(debug=True)
